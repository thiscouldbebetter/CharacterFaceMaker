<html>

<head>
	<style>
		input {
			width: 48px;
		}
	</style>
</head>

<body>

<div id="divUi">

	<h3>Character Face Maker</h3>

	<p>Edit the inputs to modify the features of the displayed face.</p>

	<div id="divInput">

		<div>
			<label>Skin Color:</label>
			<input id="inputSkinColor" value="rgb(128, 64, 0)" style="width: 128px;"></input>
		</div>

		<div>
			<label>Outline:</label>

			<div>
				<div>
					<label>Width:</label>
					<input id="inputFaceWidth" type="number" value="80"></input>

					<label>Height:</label>
					<input id="inputFaceHeight" type="number" value="100"></input>
				</div>

				<div>
					<label>Jaw:</label>

					<div>
						<label>Width:</label>
						<input id="inputJawWidth" type="number" value="60"></input>

						<label>Height:</label>
						<input id="inputJawHeight" type="number" value="30"></input>
					</div>
				</div>

				<div>
					<label>Chin:</label>

					<div>
						<label>Width:</label>
						<input id="inputChinWidth" type="number" value="20"></input>

						<label>Height:</label>
						<input id="inputChinHeight" type="number" value="3"></input>
					</div>
				</div>

			</div>
		</div>

		<div>
			<label>Eye:</label>

			<div>
				<div>
					<label>Iris Color:</label>
					<input id="inputEyeIrisColor" value="rgb(0, 128, 0)" style="width: 128px;"></input>
				</div>

				<div>
					<label>Width:</label>
					<input id="inputEyeWidth" type="number"  value="18"></input>

					<label>Height:</label>
					<input id="inputEyeHeight" type="number" value="9"></input>

					<label>Spacing:</label>
					<input id="inputEyeSpacing" type="number" value="20"></input>

				</div>

				<div>
					<label>Upper Lid Thickness:</label>
					<input id="inputEyeUpperLidThickness" type="number" value="3"></input>
				</div>

				<div>
					<label>Eyebrow Thickness:</label>
					<input id="inputEyebrowThickness" type="number" value="3"></input>
				</div>


			</div>
		</div>


		<div>
			<label>Nose:</label>

			<div>
				<label>Tip:</label>

				<div>
					<div>
						<label>Width:</label>
						<input id="inputNoseTipWidth" type="number" value="10"></input>

						<label>Height:</label>
						<input id="inputNoseTipHeight" type="number" value="5"></input>
					</div>

				</div>

			</div>

			<div>
				<label>Wing:</label>

				<div>
					<div>
						<label>Width:</label>
						<input id="inputNoseWingWidth" type="number" value="4"></input>

						<label>Height:</label>
						<input id="inputNoseWingHeight" type="number" value="6"></input>
					</div>

				</div>

			</div>

		</div>

		<div>
			<label>Mouth:</label>

			<div>
				<div>
					<label>Width:</label>
					<input id="inputMouthWidth" type="number" value="30"></input>
				</div>

				<div>
					<label>Upper Lip Thickness:</label>
					<input id="inputMouthUpperLipThickness" type="number" value="0"></input>
				</div>

				<div>
					<label>Lower Lip Thickness:</label>
					<input id="inputMouthLowerLipThickness" type="number" value="5"></input>
				</div>

			</div>
		</div>

		<div>
			<label>Ears:</label>

			<div>
				<div>
					<label>Width:</label>
					<input id="inputEarWidth" type="number" value="8"></input>

					<label>Height:</label>
					<input id="inputEarHeight" type="number" value="16"></input>
				</div>

			</div>
		</div>

		<div>
			<label>Hair:</label>

			<div>
				<div>
					<label>Color:</label>
					<input id="inputHairColor" value="rgb(16, 16, 16)" style="width: 128px;"></input>
				</div>

				<div>
					<label>Height of Hairline Above Eyes:</label>
					<input id="inputHairlineHeightAboveEyes" type="number" value="30"></input>
				</div>

				<div>
					<label>Height of Hair Above Crown:</label>
					<input id="inputHairHeightAboveCrown" type="number" value="5"></input>
				</div>

				</div>

			</div>
		</div>


	</div>

	<button onclick="buttonRender_Clicked();">Render</button>

	<div id="divOutput"></div>

</div>

<script type="text/javascript">

// UI event handlers.

function buttonRender_Clicked()
{
	var d = document;
	var c = (id) => parseFloat(d.getElementById(id).value);

	var skinColor =
		d.getElementById("inputSkinColor").value;

	var faceWidth = c("inputFaceWidth");
	var faceHeight = c("inputFaceHeight");
	var chinWidth = c("inputChinWidth");
	var chinHeight = c("inputChinHeight");
	var jawWidth = c("inputJawWidth");
	var jawHeight = c("inputJawHeight");

	var eyeIrisColor =
		d.getElementById("inputEyeIrisColor").value;

	var eyeWidth = c("inputEyeWidth");
	var eyeHeight = c("inputEyeHeight");
	var eyeSpacing = c("inputEyeSpacing");
	var eyeUpperLidThickness = c("inputEyeUpperLidThickness");
	var eyebrowThickness = c("inputEyebrowThickness");

	var noseTipWidth = c("inputNoseTipWidth");
	var noseTipHeight = c("inputNoseTipHeight");

	var noseWingWidth = c("inputNoseWingWidth");
	var noseWingHeight = c("inputNoseWingHeight");

	var mouthWidth = c("inputMouthWidth");
	var mouthUpperLipThickness = c("inputMouthUpperLipThickness");
	var mouthLowerLipThickness = c("inputMouthLowerLipThickness");

	var earWidth = c("inputEarWidth");
	var earHeight = c("inputEarHeight");

	var hairColor =
		d.getElementById("inputHairColor").value;
	var hairlineHeightAboveEyes = c("inputHairlineHeightAboveEyes");
	var hairHeightAboveCrown = c("inputHairHeightAboveCrown");

	var face = new Face
	(
		skinColor,

		new FaceFeatureOutline
		(
			new Coords(faceWidth, faceHeight),
			new Coords(chinWidth, chinHeight),
			new Coords(jawWidth, jawHeight)
		),

		new FaceFeatureEyes
		(
			eyeIrisColor,
			new Coords(eyeWidth, eyeHeight),
			eyeSpacing,
			eyeUpperLidThickness,
			eyebrowThickness
		),

		new FaceFeatureNose
		(
			noseTipWidth,
			noseTipHeight,

			noseWingWidth,
			noseWingHeight
		),

		new FaceFeatureMouth
		(
			mouthWidth,
			mouthUpperLipThickness,
			mouthLowerLipThickness
		),

		new FaceFeatureEars
		(
			new Coords(earWidth, earHeight)
		),

		new FaceFeatureHair
		(
			hairColor,
			hairlineHeightAboveEyes,
			hairHeightAboveCrown
		)
	);

	var faceAsDomElement = face.toDomElement();

	var divOutput = d.getElementById("divOutput");
	divOutput.innerHTML = "";
	divOutput.appendChild(faceAsDomElement);
}

// Classes.

class Coords
{
	constructor(x, y)
	{
		this.x = x;
		this.y = y;
	}

	static ones()
	{
		return new Coords(1, 1);
	}

	clone()
	{
		return new Coords(this.x, this.y);
	}

	divideScalar(scalar)
	{
		this.x /= scalar;
		this.y /= scalar;
		return this;
	}

	half()
	{
		return this.divideScalar(2);
	}

	invert()
	{
		return this.multiplyScalar(-1);
	}

	multiplyScalar(scalar)
	{
		this.x *= scalar;
		this.y *= scalar;
		return this;
	}

}

class Face
{
	constructor(skinColor, outline, eyes, nose, mouth, ears, hair)
	{
		this.skinColor = skinColor;
		this.outline = outline;
		this.eyes = eyes;
		this.nose = nose;
		this.mouth = mouth;
		this.ears = ears;
		this.hair = hair;
	}

	center()
	{
		if (this._center == null)
		{
			this._center = this.size().clone().half();
		}

		return this._center;
	}

	size()
	{
		if (this._size == null)
		{
			this._size = new Coords
			(
				this.outline.size.x + this.ears.size.x * 2,
				this.outline.size.y + this.hair.heightAboveCrown
			);
		}
		return this._size;
	}

	toDomElement()
	{
		var d = document;
		var canvas = d.createElement("canvas");

		var faceSize = this.size();

		canvas.width = faceSize.x;
		canvas.height = faceSize.y;

		var g = canvas.getContext("2d");
		g.strokeStyle = "Black";
		g.fillStyle = "Black";

		this.toDomElement_Outline(g);
		this.toDomElement_Eyes(g);
		this.toDomElement_Nose(g);
		this.toDomElement_Mouth(g);
		this.toDomElement_Ears(g);
		this.toDomElement_Hair(g);

		return canvas;
	}

	toDomElement_Outline(g)
	{
		var faceSize = this.outline.size;

		var faceSizeHalf = faceSize.clone().half();
		var earWidth = this.ears.size.x;
		var faceCenter = this.center();

		var chinSize = this.outline.chinSize;
		var chinWidth = chinSize.x;
		var chinWidthHalf = chinWidth / 2;
		var chinHeight = chinSize.y;
		var jawSize = this.outline.jawSize;
		var jawSizeHalf = jawSize.clone().half();

		var controlPointOffset =
			faceSizeHalf.x * .1;

		g.beginPath();
		g.moveTo(faceCenter.x, faceCenter.y - faceSizeHalf.y); // top
		g.quadraticCurveTo
		(
			faceCenter.x + faceSizeHalf.x, faceCenter.y - faceSizeHalf.y, // control point
			faceCenter.x + faceSizeHalf.x, faceSizeHalf.y
		); // Right (to the viewer) side of face.
		g.bezierCurveTo
		(
			faceCenter.x + faceSizeHalf.x,
			faceCenter.y + jawSize.y,

			faceCenter.x + jawSizeHalf.x,
			faceCenter.y + faceSizeHalf.y - chinHeight,

			faceCenter.x + chinWidthHalf,
			faceCenter.y + faceSizeHalf.y - chinHeight
		); // Right side of chin.
		g.quadraticCurveTo
		(
			faceCenter.x,
			faceCenter.y + faceSizeHalf.y,

			faceCenter.x,
			faceCenter.y + faceSizeHalf.y
		); // chin center
		g.quadraticCurveTo
		(
			faceCenter.x - chinWidthHalf,
			faceCenter.y + faceSizeHalf.y - chinHeight,

			faceCenter.x - chinWidthHalf,
			faceCenter.y + faceSizeHalf.y - chinHeight
		); // chin left
		g.bezierCurveTo
		(
			faceCenter.x - jawSizeHalf.x,
			faceSize.y - chinHeight,

			faceCenter.x - faceSizeHalf.x,
			faceCenter.y + jawSize.y,

			faceCenter.x - faceSizeHalf.x,
			faceSizeHalf.y
		); // left
		g.quadraticCurveTo
		(
			faceCenter.x - faceSizeHalf.x, faceCenter.y - faceSizeHalf.y, // control point
			faceSizeHalf.x, faceCenter.y - faceSizeHalf.y
		); // top
		g.fillStyle = this.skinColor;
		g.fill();
		g.stroke();
	}

	toDomElement_Eyes(g)
	{
		var faceCenter = this.center();
		var eyeSize = this.eyes.size;
		var eyeSizeHalf = eyeSize.clone().half();
		var eyeSpacingHalf = this.eyes.spacing / 2;
		var eyeIrisRadius = eyeSizeHalf.y * .8;
		var eyePupilRadius = eyeIrisRadius / 2;

		var sideCount = 2;

		for (var i = 0; i < sideCount; i++)
		{
			var eyeCenter =
				(i == 0)
				? new Coords(faceCenter.x - eyeSpacingHalf - eyeSizeHalf.x, faceCenter.y)
				: new Coords(faceCenter.x + eyeSpacingHalf + eyeSizeHalf.x, faceCenter.y);

			// Eye outline.

			if (i == 1)
			{
				eyeSizeHalf.x *= -1;
			}

			var multiplier = 3 / 4; // Make the eye corners pointier.
			g.beginPath();
			g.moveTo
			(
				eyeCenter.x - eyeSizeHalf.x, eyeCenter.y
			); // Outer corner.
			g.quadraticCurveTo
			(
				eyeCenter.x - eyeSizeHalf.x * multiplier, eyeCenter.y - eyeSizeHalf.y * multiplier, // control point
				eyeCenter.x, eyeCenter.y - eyeSizeHalf.y
			); // Top.
			g.quadraticCurveTo
			(
				eyeCenter.x + eyeSizeHalf.x * multiplier, eyeCenter.y - eyeSizeHalf.y * multiplier,
				eyeCenter.x + eyeSizeHalf.x, eyeCenter.y
			); // Inner corner.
			g.quadraticCurveTo
			(
				eyeCenter.x + eyeSizeHalf.x * multiplier, eyeCenter.y + eyeSizeHalf.y * multiplier,
				eyeCenter.x, eyeCenter.y + eyeSizeHalf.y
			); // Bottom.
			g.quadraticCurveTo
			(
				eyeCenter.x - eyeSizeHalf.x * multiplier, eyeCenter.y + eyeSizeHalf.y * multiplier,
				eyeCenter.x - eyeSizeHalf.x, eyeCenter.y
			); // Outer corner again.
			g.fillStyle = "White";
			g.fill();
			g.stroke();

			// Iris.
			g.beginPath();
			g.arc
			(
				eyeCenter.x, eyeCenter.y,
				eyeIrisRadius,
				0, Math.PI * 2
			);
			g.fillStyle = this.eyes.irisColor;
			g.fill();
			g.stroke();

			// Pupil.
			g.beginPath();
			g.arc
			(
				eyeCenter.x, eyeCenter.y,
				eyePupilRadius,
				0, Math.PI * 2
			);
			g.fillStyle = "Black";
			g.fill();
			g.stroke();

			// Upper lid.

			g.beginPath();
			var eyelidUpperThickness = this.eyes.lidUpperThickness;
			g.moveTo
			(
				eyeCenter.x - eyeSizeHalf.x, eyeCenter.y
			); // Outer corner.
			g.quadraticCurveTo
			(
				eyeCenter.x - eyeSizeHalf.x * multiplier,
				eyeCenter.y - (eyeSizeHalf.y + eyelidUpperThickness) * multiplier, // control point

				eyeCenter.x,
				eyeCenter.y - eyeSizeHalf.y - eyelidUpperThickness
			); // Top.
			g.quadraticCurveTo
			(
				eyeCenter.x + eyeSizeHalf.x * multiplier,
				eyeCenter.y - (eyeSizeHalf.y + eyelidUpperThickness) * multiplier,

				eyeCenter.x + eyeSizeHalf.x,
				eyeCenter.y
			); // Inner corner.
			g.stroke();

			// Eyebrow.

			var distanceBetweenEyeAndBrow = eyeSize.y;
			var eyebrowCenter = eyeCenter.clone();
			eyebrowCenter.y -= distanceBetweenEyeAndBrow;

			g.beginPath();
			g.moveTo
			(
				eyebrowCenter.x - eyeSizeHalf.x,
				eyebrowCenter.y
			);
			g.quadraticCurveTo
			(
				eyebrowCenter.x - eyeSizeHalf.x, eyebrowCenter.y - eyeSizeHalf.y, // control point
				eyebrowCenter.x, eyebrowCenter.y - eyeSizeHalf.y
			);
			g.quadraticCurveTo
			(
				eyebrowCenter.x + eyeSizeHalf.x, eyebrowCenter.y - eyeSizeHalf.y, // control point
				eyebrowCenter.x + eyeSizeHalf.x, eyebrowCenter.y
			);

			var eyebrowThickness = this.eyes.eyebrowThickness;
			g.lineWidth = eyebrowThickness;
			g.stroke();
			g.lineWidth = 1;
		}
	}

	toDomElement_Nose(g)
	{
		var faceCenter = this.center();
		var faceSize = this.size();
		var noseTipWidthHalf = this.nose.tipWidth / 2;
		var noseTipHeight = this.nose.tipHeight;
		var noseTipPosY = faceCenter.y + faceSize.y / 5;

		g.beginPath();
		g.moveTo
		(
			faceCenter.x - noseTipWidthHalf,
			noseTipPosY - noseTipHeight
		);
		g.quadraticCurveTo
		(
			faceCenter.x - noseTipWidthHalf, noseTipPosY, // control point
			faceCenter.x, noseTipPosY
		);
		g.quadraticCurveTo
		(
			faceCenter.x + noseTipWidthHalf, noseTipPosY, // control point
			faceCenter.x + noseTipWidthHalf, noseTipPosY - noseTipHeight
		);
		g.stroke();

		var noseWingWidth = this.nose.wingWidth;
		var noseWingHeight = this.nose.wingHeight;
		var noseWingHeightHalf = noseWingHeight / 2;

		var sideCount = 2;
		for (var i = 0; i < sideCount; i++)
		{
			if (i == 1)
			{
				noseTipWidthHalf *= -1;
				noseWingWidth *= -1;
			}

			g.beginPath();
			g.moveTo
			(
				faceCenter.x - noseTipWidthHalf, noseTipPosY - noseWingHeight
			);
			g.quadraticCurveTo
			(
				faceCenter.x - noseTipWidthHalf - noseWingWidth, noseTipPosY - noseWingHeight,
				faceCenter.x - noseTipWidthHalf - noseWingWidth, noseTipPosY - noseWingHeightHalf
			);
			g.quadraticCurveTo
			(
				faceCenter.x - noseTipWidthHalf - noseWingWidth, noseTipPosY,
				faceCenter.x - noseTipWidthHalf, noseTipPosY
			);
			g.stroke();
		}
	}

	toDomElement_Mouth(g)
	{
		var faceCenter = this.center();
		var faceSize = this.size();
		var mouthWidthHalf = this.mouth.width / 2;
		var mouthPosY = faceCenter.y + faceSize.y * .3;
		g.beginPath();
		g.moveTo
		(
			faceCenter.x - mouthWidthHalf,
			mouthPosY
		);
		g.lineTo
		(
			faceCenter.x + mouthWidthHalf,
			mouthPosY
		);
		g.stroke();

		var mouthLipLowerThickness = this.mouth.lipThicknessLower;
		var mouthLipLowerWidthHalf = mouthWidthHalf / 2;

		g.beginPath();
		g.moveTo
		(
			faceCenter.x - mouthLipLowerWidthHalf,
			mouthPosY + mouthLipLowerThickness
		);
		g.lineTo
		(
			faceCenter.x + mouthLipLowerWidthHalf,
			mouthPosY + mouthLipLowerThickness
		);
		g.stroke();
	}

	toDomElement_Ears(g)
	{
		var faceCenter = this.center();
		var faceOutlineSize = this.outline.size;
		var earSize = this.ears.size;
		var earWidth = earSize.x;
		var earWidthHalf = earWidth / 2;
		var earHeight = earSize.y;
		var earHeightHalf = earHeight / 2;
		var tragusSize = new Coords(.5, 2).multiplyScalar(earWidth).half();

		var sideCount = 2;
		for (var i = 0; i < sideCount; i++)
		{
			var earStart =
				i == 0
				? new Coords(faceCenter.x + faceOutlineSize.x / 2, faceCenter.y)
				: new Coords(faceCenter.x - faceOutlineSize.x / 2, faceCenter.y);

			if (i == 1)
			{
				earWidth *= -1;
				earWidthHalf *= -1;
				tragusSize.x *= -1;
			}

			g.beginPath();
			g.moveTo(earStart.x, earStart.y); // Top attachment.
			g.quadraticCurveTo
			(
				earStart.x, earStart.y - earHeightHalf,
				earStart.x + earWidthHalf, earStart.y - earHeightHalf
			); // Top.
			g.quadraticCurveTo
			(
				earStart.x + earWidth, earStart.y - earHeightHalf,
				earStart.x + earWidth, earStart.y
			); // Outer.
			g.quadraticCurveTo
			(
				earStart.x + earWidthHalf, earStart.y + earHeight,
				earStart.x, earStart.y + earHeight
			); // Lobe.
			g.closePath(); // hack
			g.fillStyle = this.skinColor;
			g.fill();
			g.stroke();

			// Tragus.

			g.beginPath();
			g.moveTo(earStart.x, earStart.y);
			g.quadraticCurveTo
			(
				earStart.x + tragusSize.x,
				earStart.y,

				earStart.x + tragusSize.x,
				earStart.y + tragusSize.y / 2
			);
			g.quadraticCurveTo
			(
				earStart.x + tragusSize.x,
				earStart.y + tragusSize.y,

				earStart.x,
				earStart.y + tragusSize.y
			);
			g.stroke();

			// Helix.

			var helixThickness = 3;
			earStart.y += helixThickness;

			g.beginPath();
			g.moveTo(earStart.x, earStart.y);
			g.quadraticCurveTo
			(
				earStart.x, earStart.y - earHeightHalf,
				earStart.x + earWidthHalf, earStart.y - earHeightHalf
			);
			g.quadraticCurveTo
			(
				earStart.x + earWidth, earStart.y - earHeightHalf,
				earStart.x + earWidth, earStart.y
			); // Outer.
			g.stroke();
		}
	}

	toDomElement_Hair(g)
	{
		var faceCenter = this.center();
		var faceOutlineSize = this.outline.size;
		var faceOutlineSizeHalf = faceOutlineSize.clone().half();

		var hairlineFractionOfWidth = .6;

		g.beginPath();
		g.moveTo(faceCenter.x - faceOutlineSizeHalf.x, faceCenter.y);
		g.lineTo
		(
			faceCenter.x - faceOutlineSizeHalf.x * hairlineFractionOfWidth,
			faceCenter.y - this.hair.hairlineHeightAboveEyes
		);
		g.lineTo
		(
			faceCenter.x + faceOutlineSizeHalf.x * hairlineFractionOfWidth,
			faceCenter.y - this.hair.hairlineHeightAboveEyes
		);
		g.lineTo
		(
			faceCenter.x + faceOutlineSizeHalf.x, faceCenter.y
		);
		g.quadraticCurveTo
		(
			faceCenter.x + faceOutlineSizeHalf.x, 
			faceCenter.y - faceOutlineSizeHalf.y - this.hair.heightAboveCrown,

			faceCenter.x,
			faceCenter.y - faceOutlineSizeHalf.y - this.hair.heightAboveCrown
		);
		g.quadraticCurveTo
		(
			faceCenter.x - faceOutlineSizeHalf.x,
			faceCenter.y - faceOutlineSizeHalf.y - this.hair.heightAboveCrown,

			faceCenter.x - faceOutlineSizeHalf.x,
			faceCenter.y
		);
		g.fillStyle = this.hair.color;
		g.fill();
		g.stroke();
	}

}

class FaceFeatureEars
{
	constructor(size)
	{
		this.size = size;
	}
}

class FaceFeatureEyes
{
	constructor
	(
		irisColor,
		size,
		spacing,
		lidUpperThickness,
		eyebrowThickness
	)
	{
		this.irisColor = irisColor;
		this.size = size;
		this.spacing = spacing;
		this.lidUpperThickness = lidUpperThickness;
		this.eyebrowThickness = eyebrowThickness;
	}
}

class FaceFeatureHair
{
	constructor(color, hairlineHeightAboveEyes, heightAboveCrown)
	{
		this.color = color;
		this.hairlineHeightAboveEyes = hairlineHeightAboveEyes;
		this.heightAboveCrown = heightAboveCrown;
	}
}

class FaceFeatureMouth
{
	constructor(width, lipThicknessUpper, lipThicknessLower)
	{
		this.width = width;
		this.lipThicknessUpper = lipThicknessUpper;
		this.lipThicknessLower = lipThicknessLower;
	}
}

class FaceFeatureNose
{
	constructor(tipWidth, tipHeight, wingWidth, wingHeight)
	{
		this.tipWidth = tipWidth;
		this.tipHeight = tipHeight;
		this.wingWidth = wingWidth;
		this.wingHeight = wingHeight;
	}
}

class FaceFeatureOutline
{
	constructor(size, chinSize, jawSize)
	{
		this.size = size;
		this.chinSize = chinSize;
		this.jawSize = jawSize;
	}
}

</script>

</body>
</html>